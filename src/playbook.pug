---
layout: layouts/base.pug
---
.title Какие песни поем?
is-land(on:visible)
    div#playbook-app(v-scope='Playbook()')
        template(data-island)
            .box.p-5.m-5
                ul#song-list.block
                    li(v-for='(song, index) in list' :key="index" class='block')
                        span.tag.is-medium
                            div {{ song }}
                            button.delete.is-medium(aria-label="Delete" @click='remove(index)')
                .block.field.has-addons
                    .control.is-expanded
                        input#song-input.input(
                            ref='songInput'
                            type='text'
                            v-model='newSong'
                            placeholder='Номер гимна'
                            @keyup.enter='add'
                        )
                    .control 
                        #add-song-btn.button.is-primary(@click='add') Добавить
                .block 
                    button#start-btn.button.is-link.is-medium.is-fullwidth(:disabled="list.length === 0" @click="start") Поехали
    template(data-island)
        script(type="module").
            import { createApp } from "https://unpkg.com/petite-vue@0.4.1/dist/petite-vue.es.js";
            function Playbook(props) {
                return {
                    newSong: "",
                    list: [],
                    add() {
                        if (this.newSong && !isNaN(this.newSong)) {
                            this.list.push(this.newSong);
                            this.newSong = "";
                        }
                        this.$refs.songInput.focus();
                    },
                    remove(index) {
                        this.list.splice(index, 1);
                    },
                    start() {
                        const hymns = this.list.map(el => `/hymns/${el}`);
                        sessionStorage.setItem("list", window.btoa(hymns.join(";")));
                        window.location.replace(hymns[0]);
                    } 
                }
            }
            createApp({Playbook}).mount("#playbook-app");
